<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cantonese Conversation Tutor</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>廣東話對話導師</h1>
        <p class="subtitle">桌面網頁體驗 · 模擬語音對話 · 立即練習</p>
        <div class="badges">
          <span class="pill">AI 導師</span>
          <span class="pill">語音對話</span>
          <span class="pill">實時反饋</span>
        </div>
      </div>
      <div class="header-status">
        <div class="system-state" id="systemState" role="status" aria-live="polite">
          <span class="state-icon" id="stateIcon" aria-hidden="true"></span>
          <span class="state-label" id="stateLabel">就緒</span>
        </div>
        <div class="status" id="status">連線中...</div>
      </div>
    </header>

    <section class="hero">
      <div>
        <p class="hero-kicker">練口語 · 聽語感 · 改發音</p>
        <h2>和 AI 對話，像真人陪練</h2>
        <p class="hero-body">按住說話或輸入文字，獲取即時廣東話回應與語音播報，適合桌面麥克風場景。</p>
      </div>
    </section>

    <div class="panel">
      <section class="controls">
        <label for="scenario">情景：</label>
        <select id="scenario"></select>
        <button id="newSession">開始新對話</button>
      </section>

      <section class="starter" aria-label="建議開場白">
        <div class="starter-header">
          <span>開場建議</span>
          <small>點擊一句即填入</small>
        </div>
        <div id="starterChips" class="chips"></div>
      </section>

      <div id="notice" class="notice" role="status" aria-live="polite"></div>
      <section class="transcript" aria-label="對話內容">
        <div class="transcript-header">
          <div>
            <div class="pill" id="scenarioPill">情景：自由對話</div>
            <div class="pill pill-secondary" id="sessionPill">未開始</div>
            <div class="pill pill-secondary" id="ttsPill">語音：偵測中</div>
          </div>
          <button id="clearChat" class="ghost">清除記錄</button>
        </div>
        <div id="transcript" class="transcript-body"></div>
      </section>

      <section class="input-panel">
        <button id="holdToSpeak" class="mic">按住說話（模擬）</button>
        <input id="textInput" type="text" placeholder="或輸入一句廣東話..." />
        <div class="audio-controls">
          <label for="speed">速度</label>
          <select id="speed">
            <option value="0.9">0.9x</option>
            <option value="1" selected>1.0x</option>
            <option value="1.1">1.1x</option>
            <option value="1.2">1.2x</option>
          </select>
          <button id="replay">重播</button>
        </div>
        <button id="sendText">發送</button>
      </section>

      <section class="feedback-panel">
        <div class="feedback-immediate" id="feedbackImmediate">
          <h3>即時反饋</h3>
          <div id="topCorrections" class="corrections-list"></div>
        </div>
        <details class="feedback-deep" id="feedbackDeep">
          <summary>詳細分析</summary>
          <div id="feedbackDetails" class="feedback-details"></div>
        </details>
      </section>
    </div>

    <!-- Mic Permission Dialog -->
    <dialog id="micPermissionDialog" class="modal" aria-labelledby="micDialogTitle">
      <div class="modal-content">
        <h2 id="micDialogTitle">麥克風權限</h2>
        <p>我哋需要您嘅麥克風權限，先可以聽到您嘅廣東話發音並提供反饋。</p>
        <div class="modal-actions">
          <button id="micDenyBtn" class="ghost">使用打字代替</button>
          <button id="micAllowBtn">允許麥克風</button>
        </div>
      </div>
    </dialog>

    <!-- Mic Blocked Help Dialog -->
    <dialog id="micBlockedDialog" class="modal" aria-labelledby="micBlockedTitle">
      <div class="modal-content">
        <h2 id="micBlockedTitle">麥克風被阻擋</h2>
        <p>請喺瀏覽器設置中允許呢個網站使用麥克風：</p>
        <ol>
          <li>點擊地址欄左側嘅鎖形圖標</li>
          <li>揀「網站設置」或「權限」</li>
          <li>將麥克風設為「允許」</li>
        </ol>
        <div class="modal-actions">
          <button id="micBlockedClose" class="ghost">使用打字代替</button>
          <button id="micBlockedRetry">重試</button>
        </div>
      </div>
    </dialog>

    <section class="info-grid">
      <div class="info-card">
        <h3>如何開始</h3>
        <ol>
          <li>選擇情景後按「開始新對話」。</li>
          <li>按住麥克風按鈕說話，或直接輸入文字。</li>
          <li>點「播放」或「重播」聽導師語音，可調整速度。</li>
        </ol>
      </div>
      <div class="info-card">
        <h3>小貼士</h3>
        <ul>
          <li>放慢語速，讓導師更準確給出反饋。</li>
          <li>用「餐廳點餐」等情景，練習實用對話。</li>
          <li>重播時可調速度，聽清楚聲調與語氣。</li>
        </ul>
      </div>
    </section>

    <footer class="footer">© 2025 Cantonese Tutor · 桌面版體驗 · 支持實時語音與文字輸入</footer>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
